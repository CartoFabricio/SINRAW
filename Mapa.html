<!DOCTYPE html>
<html lang="en">
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

		<title>SINRAW</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="">
		<meta name="author" content="">

		<link href="./Bootstrap/bootstrap.css" rel="stylesheet">
    <link href="./Bootstrap/bootstrap-responsive.css" rel="stylesheet">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="https://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="https://getbootstrap.com/2.3.2/assets/ico/favicon.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link type="text/css" rel="stylesheet" href="/icons/GlyphiconsV2/font/glyphicons.css" media="all">
    <link type="text/css" rel="stylesheet" href="/icons/GlyphiconsV2/font/style.css" media="all">

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

		<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
		<script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
		<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
		<script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>


		<script src="https://api.tiles.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.js"></script>
		<link href="https://api.tiles.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.css" rel="stylesheet">
		<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js"></script>
		<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css" type="text/css">
  </head>

<style>
#menu{position: fixed; top: 0%; right:2%; width: 100%;  z-index: 3;}

#map { position: fixed; top: 6.5%; bottom: 0%; height:93.5%; left:0%; width: 100%;  z-index: 1;}

#instructions {
  position: relative;
  width: 0%;
  height:0%;
  background-color: #fff;
  font-family: sans-serif;
  z-index: 1;
}
.informacoes {
  position: fixed;
  width: 20%;
  height:20%;
  top:30%;
  background-color: #fff;
  font-family: sans-serif;
  z-index: 2;
}

.direction {
  position: absolute;
  z-index:2;
  max-width: 80px;
  width: 25%;
  height: 10%;
  left: 0.2%;
  top: 6.5%;
}

.navbar-form label{
    left: 5%;
    align-items:left;
    padding-top: 0.7%;
    display: inline;
    }

.swatch {
  display: inline-block;
  width: 20px;
  height: 20px;
  margin-right: 5px;
  cursor: pointer;
}

.toggle-container {
    display: flex;
    align-items: center;
}

.height-range {
  margin-top: 10px;
}

.nav{padding-left: 5%}
#collapse1{
  padding-right: 15%;
}

.map-overlay {
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    position: fixed;
    background-color: rgba(0,0,0,0) !important;
    top: 29.6%;
    left: 90.8%;
    z-index: 2;
    width: 30px;
    height: 25px;
}

.map-overlay-inner {
  position: fixed;
  width: 45%;
  top: 17.5%;
  left: 1%;
  background-color: #FFFFFF;
  padding: 10px;
  z-index: 1;
}

.map-overlay-inner fieldset {
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  border: none;
  padding: 0;
  margin: 0 0 10px;
}

.map-overlay-inner fieldset:last-child {
  margin: 0;
}

.map-overlay-inner select {
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  width: 100%;
}

.map-overlay-inner label {
  font: 13px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  display: block;
  font-weight: bold;
  text-shadow: 0 0 12px #FFFFFF, 0 0 12px #FFFFFF;
}

.map-overlay-inner button {
  display: inline-block;
  width: 36px;
  height: 20px;
  border: 1px;
  cursor: pointer;
}

.map-overlay-inner button:focus {
  outline: none;
}

.map-overlay-inner button:hover {
  box-shadow: inset 0 0 0 3px rgba(0, 0, 0, 0.1);
}

.swatch {
  display: inline-block;
  width: 20px;
  height: 20px;
  margin-right: 5px;
  cursor: pointer;
  border: 1px solid #000000;
}

.height-range {
  margin-top: 10px;
}

.toggle-container {
    display: flex;
    align-items: center;
}

#controls {
  position: fixed;
  top: 22%;
  left: 2%;
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  font-weight: bold;
}
#collapsibleControls{
  margin-top: 20%; left: 2%; padding: 20px;  position: absolute; font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif; font-weight: bold;z-index:2;
}
#collapseButton {
  position: fixed;
  cursor: pointer;
  background-color: #F8F9FA;
  margin:10px;
  top: 90%;
  left: 2%;
  width: 36px;
  height: 30px;
}

.collapsible {
  background-color:rgba(0,0,0,0) !important;
  text-shadow: 0 0 12px #FFFFFF, 0 0 12px #FFFFFF;
}

</style>

<div id = 'menu'>
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container-fluid">
				<button type="button" id="collapse1" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li><a href="./index.html">Início</a></li>
						<li><a href="./Mapa.html">SINRAW - Mapa</a></li>
						<li><a href="./AR.html">SINRAW - AR</a></li>
						<li><a href="./SINRAW.html">SINRAW - Mapa + AR </a></li>
						<li><a href="./Simbolos3D.html">Visualização 3D</a></li>
						<li><a href="./Avaliacao.html">Questionário de Caracterização</a></li>
						<li><a href="./AvaliacaoFinal.html">Questionário Mapa + AR</a></li>
						<li><a href="./Contato.html">Contato</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<body>
	<div id="direction" class="direction"></div>

	<div id="map" class="mapboxgl-map">
		<div class="mapboxgl-canary" style="visibility: hidden;"></div>
	<div class="mapboxgl-canvas-container mapboxgl-interactive mapboxgl-touch-drag-pan mapboxgl-touch-zoom-rotate" >
			<canvas class="mapboxgl-canvas"tabindex="0" aria-label="Map" role="region" ></canvas>
		</div>
	</div>

	<div id= "map-overlay" class="map-overlay">
    <button type="button" data-toggle="collapse" onclick="toggleCollapse()" style="font-size: 20px" data-target="#collapsibleControls"><span class="glyphicon glyphicon-cog" aria-hidden="false"> </button>
    <div id="collapsibleControls" class="collapse">
            <div class="map-overlay-inner">
                 <fieldset>
                    <label>Mapa Base
                    <select id='basemap-selector' name='basemap-selector'>
                        <option value='mapbox://styles/mapbox/streets-v11'>Streets</option>
												<option value='mapbox://styles/mapbox/light-v10'>Light</option>
                        <option value='mapbox://styles/mapbox/satellite-v9'>Satellite</option>
                        <option value='mapbox://styles/mapbox/dark-v10'>Dark</option>
                        <option value='mapbox://styles/mapbox/outdoors-v11'>Outdoors</option>
                        <option value='mapbox://styles/mapbox/navigation-day-v1'>navigation-day</option>
                        <option value='mapbox://styles/mapbox/navigation-night-v1'>navigation-night</option>
                    </select></label>
                </fieldset>

								<fieldset>
                     <label>Ângulo de Elevação:<span id="pitch-slider-value">0</span></label>
                    <input type='range' id='pitch-slider' min='0' max='90' value='0' step='1'>
                    <label>Rotação: <span id="slider-value1">0</span></label>
                    <input type='range' id='bearing-slider' min='0' max='360' value='0' step='1'>
                </fieldset>
                <fieldset>
                    <label>Editar camada</label>
                    <select id='layer-select'>
											<option value='layer1'>Ponto de Ônibus</option>
											<option value='layer2'>Entrada / Saída</option>
											<option value='layer3'>Restaurante</option>
											<option value='layer4'>Correios</option>
											<option value='layer5'>Estacionamento</option>
                    </select>
                </fieldset>
                <fieldset>
                    <label>Cor de preenchimento</label>
                      <div id='swatches1'></div>
                </fieldset>
              <fieldset>
                  <label for='icon-size'>Tamanho do ícone:<span id='icon-size-label'> 15 px</span></label>
                  <input type='range' id='icon-size' min='0' max='30' step='1' value='15' class='height-range' />
              </fieldset>
             	<fieldset>
								<div class='toggle-container'>
									<label for='toggle'>
										<input type='checkbox' id='toggle' checked > Construções 3D </label>
								</div>
              </fieldset>
            </div>
        </div>
     </div>
	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="./Bootstrap/jquery.js.download"></script>
	<script src="./Bootstrap/bootstrap-transition.js.download"></script>
	<script src="./Bootstrap/bootstrap-alert.js.download"></script>
	<script src="./Bootstrap/bootstrap-modal.js.download"></script>
	<script src="./Bootstrap/bootstrap-dropdown.js.download"></script>
	<script src="./Bootstrap/bootstrap-scrollspy.js.download"></script>
	<script src="./Bootstrap/bootstrap-tab.js.download"></script>
	<script src="./Bootstrap/bootstrap-tooltip.js.download"></script>
	<script src="./Bootstrap/bootstrap-popover.js.download"></script>
	<script src="./Bootstrap/bootstrap-button.js.download"></script>
	<script src="./Bootstrap/bootstrap-collapse.js.download"></script>
	<script src="./Bootstrap/bootstrap-carousel.js.download"></script>
	<script src="./Bootstrap/bootstrap-typeahead.js.download"></script>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiZmFicmljaW9hbW9yaW0iLCJhIjoiY2tsaWNsOHRkMmgwaDJucGN0NGJhd3psOSJ9.h665zPxHXNFNVIzh1cJeUQ';

navigator.geolocation.getCurrentPosition( function(position) {
  var lng = position.coords.longitude;
  var lat = position.coords.latitude;
  sessionStorage.setItem("lng", lng);
  sessionStorage.setItem("lat", lat);
  const map = new mapboxgl.Map({
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [lng, lat], //longitude, latitude
    zoom: 17,
    pitch: 80,
    bearing: 0,
    container: 'map',
    antialias: false,
    attributionControl:true,
  });
    map.on('style.load', () => {
        map.setFog({}); // Set the default atmosphere style
    });

  var basemapSelector = document.getElementById('basemap-selector');
  basemapSelector.addEventListener('change', function () {
    var basemap = basemapSelector.value;
    map.setStyle(basemap);
  });

	// Get the range input elements and span elements
	const pitchSlider = document.getElementById('pitch-slider');
	const pitchValueSpan = document.getElementById('pitch-slider-value');
	const bearingSlider = document.getElementById('bearing-slider');
	const bearingValueSpan = document.getElementById('slider-value1');

	// Function to update the pitch value
	function updatePitchValue() {
		const pitchValue = pitchSlider.value;
		pitchValueSpan.textContent = pitchValue;
		 map.setPitch(pitchValue);
	}

	// Function to update the bearing value
	function updateBearingValue() {
		const bearingValue = bearingSlider.value;
		bearingValueSpan.textContent = bearingValue;
		 map.setBearing(bearingValue);
	}
	// Add event listeners to the range inputs
	pitchSlider.addEventListener('input', updatePitchValue);
	bearingSlider.addEventListener('input', updateBearingValue);

 // Create marker arrays for each layer
  var layer1Markers = [ // Bus symbol
      { coordinates: [-49.232580, -25.453163], color: '#000000', size: 15 },
      { coordinates: [-49.232136, -25.449854], color: '#000000', size: 15 },
  ];

  var layer2Markers = [ // School symbol
      { coordinates: [-49.229949, -25.451687], color: '#000000', size: 15, },
      { coordinates: [-49.232931, -25.453522], color: '#000000', size: 15, },
      { coordinates: [-49.230441, -25.449003], color: '#000000', size: 15, },
  ];

  var layer3Markers = [// Food symbol
      { coordinates: [-49.235028, -25.449557], color: '#000000', size: 15 },
  ];

  var layer4Markers = [// Correios symbol
      { coordinates: [-49.234099, -25.44999], color: '#000000', size: 15 },
  ];


  var layer5Markers = [  //glyphicon glyphicon-gbp
    {coordinates: [ -49.233085960737924, -25.453344376797858], color: '#000000',size: 15},
    {coordinates: [ -49.23354358116649,-25.453187921663584], color: '#000000',size: 15},
    {coordinates: [-49.23282382864804,-25.453051524714468], color: '#000000',size: 15},
    {coordinates: [-49.23257058239133, -25.4525661107876], color: '#000000',size: 15},
    {coordinates: [ -49.23213331089232,-25.453098276993444], color: '#000000',size: 15},
    {coordinates: [ -49.23144208152905, -25.451743710824402], color: '#000000',size: 15},
    {coordinates: [ -49.23181972945565, -25.451839992085638], color: '#000000',size: 15},
    {coordinates: [  -49.233814601085186, -25.452473841045702], color: '#000000',size: 15},
    {coordinates: [ -49.233485825243434,  -25.451787838988665], color: '#000000',size: 15},
    {coordinates: [ -49.233112620233754,-25.45097345720221], color: '#000000',size: 15},
    {coordinates: [ -49.23224625146139, -25.451860049915567], color: '#000000',size: 15},
    {coordinates: [ -49.23196634770443,-25.451254279129785], color: '#000000',size: 15},
    {coordinates: [ -49.23080230869519, -25.451559174926842], color: '#000000',size: 15},
    {coordinates: [ -49.232333417311594,-25.45015945481181], color: '#000000',size: 15},
    {coordinates: [  -49.23350634734177, -25.450785289871703], color: '#000000',size: 15},
    {coordinates: [  -49.233712099088876, -25.4498493260068], color: '#000000',size: 15},
    {coordinates: [ -49.234609568278984, -25.450045903260985], color: '#000000',size: 15},
    {coordinates: [ -49.23063575000012, -25.44960241230737], color: '#000000',size: 15},
    {coordinates: [ -49.231398728557224, -25.44807491690277], color: '#000000',size: 15},
    {coordinates: [  -49.231660321594376,-25.447630050165046], color: '#000000',size: 15},
    {coordinates: [ -49.2336527885561, -25.44729147791888], color: '#000000',size: 15},
    {coordinates: [ -49.23665128297114, -25.452082228467205], color: '#000000',size: 15},
    {coordinates: [ -49.236088857942406, -25.45103505227719], color: '#000000',size: 15},
];



  function addMarkerLayer(markers, layerId) {
      markers.forEach(function(marker, index) {
          var el = document.createElement('div');
          el.className = 'marker ' + layerId;
          el.style.color = marker.color;
          el.style.fontSize = marker.size + 'px';
          el.style.lineHeight = marker.size + 'px';
          el.style.cursor = 'pointer';

          // Set marker content based on the layerId
          switch (layerId) {
              case 'layer1':
                  el.innerHTML = '<i class="fas fa-bus"></i>'; // Bus symbol
                  break;
              case 'layer2':
                  el.innerHTML = '<i class="fas fa-school"></i>'; // School symbol
                  break;
              case 'layer3':
                  el.innerHTML = '<i class="fas fa-utensils"></i>'; // Food symbol
                  break;
               case 'layer4':
                  el.innerHTML = '<i class="fas fa-envelope"></i>'; // Correios symbol
                  break;
               case 'layer5':
                  el.innerHTML = '<i class="fas fa-car" ></i>'; // Estacionamento symbol
                  break;
              default:
                  break;
          }

          new mapboxgl.Marker(el)
              .setLngLat(marker.coordinates)
              .addTo(map)
              .getElement()
              .addEventListener('click', function() {
                  // Handle marker click event if needed
                  console.log('Marker clicked: Layer ' + layerId + ', Index ' + index);
              });
          });
      }

      addMarkerLayer(layer1Markers, 'layer1');
      addMarkerLayer(layer2Markers, 'layer2');
      addMarkerLayer(layer3Markers, 'layer3');
      addMarkerLayer(layer4Markers, 'layer4');
      addMarkerLayer(layer5Markers, 'layer5');

      // Bind event listeners to layer controls
      var layerSelect = document.getElementById('layer-select');
      var swatches1 = document.getElementById('swatches1');
      var iconSizeInput = document.getElementById('icon-size');
      const rangeLabel = document.getElementById('icon-size-label');

      layerSelect.addEventListener('change', function() {
          var selectedLayer = layerSelect.value;

          // Update marker colors for the selected layer
          var markers = document.getElementsByClassName(selectedLayer);
          Array.from(markers).forEach(function(marker) {
              marker.style.background = layerColorInput.value;
          });

          // Update marker sizes for the selected layer

          iconSizeInput.addEventListener('input', () => {
            rangeLabel.textContent = iconSizeInput.value;
          });
      });


      function changeMarkerColor(color) {
          var selectedLayer = layerSelect.value;

          // Update marker colors for the selected layer
          var markers = document.getElementsByClassName(selectedLayer);
          Array.from(markers).forEach(function(marker) {
              marker.style.color = color;
          });
      }

      // Function to create a color swatch
      function createSwatch(color) {
          const swatch = document.createElement('div');
          swatch.className = 'swatch';
          swatch.style.backgroundColor = color;
          swatch.addEventListener('click', () => {
              changeMarkerColor(color);
          });
          return swatch;
      }

      const colors = ['#ffffff', '#ffffcc', '#a1dab4', '#41b6c4', '#2c7fb8', '#253494','#fed976', '#feb24c', '#fd8d3c', '#f03b20', '#bd0026', '#000000'];


      // Create color swatches and set event listeners
      for (const color of colors) {
          const swatch = createSwatch(color);
          swatches1.appendChild(swatch);
      }

      function handleIconSizeChange() {
          var size = parseFloat(iconSizeInput.value);
          var selectedLayer = layerSelect.value;
          var markers = document.getElementsByClassName(selectedLayer);
          Array.from(markers).forEach(function(marker) {
              marker.style.fontSize = size + 'px';
          });
      }

      iconSizeInput.addEventListener('input', handleIconSizeChange);

      // Update initial marker sizes based on the default layer selection and size
      var initialSelectedLayer = layerSelect.value;
      var initialSize = parseFloat(iconSizeInput.value);
      var initialMarkers = document.getElementsByClassName(initialSelectedLayer);
      Array.from(initialMarkers).forEach(function(marker) {
          marker.style.fontSize = initialSize + 'px';
          });
      var iconSizeInput = document.getElementById('icon-size');
      iconSizeInput.addEventListener('input', () => {
        rangeLabel.textContent = iconSizeInput.value + ' px';
      });

direction = new MapboxDirections({
  accessToken: mapboxgl.accessToken,
  language: 'pt-BR',
  showCompass: true,
  geometry: 'polyline',
  unit: 'metric',
  profile: 'mapbox/walking',
  language: 'pt-BR',
  placeholderOrigin: 'Origem',
  placeholderDestination: 'Destino',
  controls: {
      profileSwitcher: false,
      instructions: false,
  },
});

map.on('load', function() {
  var direction = new MapboxDirections({
    accessToken: mapboxgl.accessToken
  });
  direction.setOrigin([lng,lat]);
});

document.getElementById('direction').appendChild(direction.onAdd(map));

// an arbitrary start will always be the same
// only the end or destination will change
const start = [lng, lat];

// create a function to make a directions request
async function getRoute(end) {
  // make directions request using cycling profile
  const query = await fetch(
    `https://api.mapbox.com/directions/v5/mapbox/walking/${start[0]},${start[1]};${end[0]},${end[1]}?steps=true&geometries=geojson&access_token=${mapboxgl.accessToken}`,
    { method: 'GET' }
  );
  const json = await query.json();
  const data = json.routes[0];
  const route = data.geometry.coordinates;
  const geojson = {
    'type': 'Feature',
    'properties': {},
    'geometry': {
      'type': 'LineString',
      'coordinates': route
    }
  };

  // if the route already exists on the map, we'll reset it using setData
  if (map.getSource('route')) {
    map.getSource('route').setData(geojson);
  }
  // otherwise, we'll make a new request
  else {
    map.addLayer({
      'id': 'route',
      'type': 'line',
      'source': {
        'type': 'geojson',
        'data': geojson
      },
      'layout': {
        'line-join': 'round',
        'line-cap': 'round'
      },
      'paint': {
        'line-color': '#3887be',
        'line-width': 0,
        'line-opacity': 0.75
      }
    });
  }

//			document.getElementById("orig").textContent = JSON.stringify(geojson, undefined, 2);

  // get the sidebar and add the instructions
  const instructions = document.getElementById('instructions');
  const steps = data.legs[0].steps;
  let tripInstructions = '';
  for (const step of steps) {
    tripInstructions += `<li>${step.maneuver.instruction}</li>`;
  }
  instructions.innerHTML = `<p><strong>Trip duration: ${Math.floor(
    data.duration / 60
  )} min 🚴 </strong></p><ol>${tripInstructions}</ol>`;
}

map.on('load', () => {
  // make an initial directions request that
  // starts and ends at the same location
  getRoute(start);

  // Add destination to the map
  map.addLayer({
    'id': 'point',
    'type': 'circle',
    'source': {
      'type': 'geojson',
      'data': {
        'type': 'FeatureCollection',
        'features': [
          {
            'type': 'Feature',
            'properties': {},
            'geometry': {
              'type': 'Point',
              'coordinates': start
            }
          }
        ]
      }
    },
    'paint': {
      'circle-radius': 0,
      'circle-color': '#3887be'
    }
  });

  // allow the user to click the map to change the destination
  map.on('click', (event) => {
    const coords = Object.keys(event.lngLat).map(
      (key) => event.lngLat[key]
    );
    const end = {
      'type': 'FeatureCollection',
      'features': [
        {
          'type': 'Feature',
          'properties': {},
          'geometry': {
            'type': 'Point',
            'coordinates': coords
          }
        }
      ]
    };
    if (map.getLayer('end')) {
      map.getSource('end').setData(end);
    } else {
      map.addLayer({
        'id': 'end',
        'type': 'circle',
        'source': {
          'type': 'geojson',
          'data': {
            'type': 'FeatureCollection',
            'features': [
              {
                'type': 'Feature',
                'properties': {},
                'geometry': {
                  'type': 'Point',
                  'coordinates': coords
                }
              }
            ]
          }
        },
        'paint': {
          'circle-radius': 0,
          'circle-color': '#f30'
        }
      });
    }
    getRoute(coords);
  });
});

var nav = new mapboxgl.NavigationControl();
        map.addControl(nav, 'top-right');

map.addControl(new mapboxgl.FullscreenControl(), 'top-right');

var geolocate = new mapboxgl.GeolocateControl();
map.addControl(
    geolocate = new mapboxgl.GeolocateControl({
    positionOptions: {
    enableHighAccuracy: true
    },
    trackUserLocation: true,
    showUserHeading: true,
  }),'top-right'
);

  // Add 3D Buildings Layer
  map.on('load', function () {
    map.addLayer({
      'id': '3d-buildings',
      'source': 'composite',
      'source-layer': 'building',
      'filter': ['==', 'extrude', 'true'],
      'type': 'fill-extrusion',
      'minzoom': 10,
      'paint': {
        'fill-extrusion-color': '#aaa',
        'fill-extrusion-height': ["get", "height"],
        'fill-extrusion-base': ["get", "min_height"],
        'fill-extrusion-opacity': 0.6
      }
    });
  });

  // Toggle 3D Buildings
  var toggle = document.getElementById('toggle');
  toggle.addEventListener('change', function () {
    if (toggle.checked) {
      map.setLayoutProperty('3d-buildings', 'visibility', 'visible');
    } else {
      map.setLayoutProperty('3d-buildings', 'visibility', 'none');
    }
  });
});

		// Function to toggle the visibility of the collapsible controls
		function toggleCollapse() {
			var collapsible = document.getElementById("collapsibleControls");
			collapsible.classList.toggle("collapsed");
		}

	</script>
</body>
</html>
